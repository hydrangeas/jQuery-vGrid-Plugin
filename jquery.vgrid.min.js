/**
 * jQuery VGrid v0.1.8 - variable grid layout plugin
 *
 * Terms of Use - jQuery VGrid
 * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
 *
 * Copyright 2009-2012 xlune.com All rights reserved.
 * (http://blog.xlune.com/2009/09/jqueryvgrid.html)
 */(function(a){function b(b){var e=b.data("_vgchild"),f=b.width(),g=[[0,f,0]],h=0,k,l,m;e.each(function(b){k=a(this);if(k.css("display")=="none")return!0;l=i(k),m=c(g,l[0]),g=d(g,m,l),h=Math.max(h,m[1]+l[1]),k.data("_vgleft",m[0]),k.data("_vgtop",m[1])}),b.data("_vgwrapheight",h),j(b)}function c(a,b){var c=a.concat().sort(e),d=c[c.length-1][2];for(var f=0,g=c.length;f<g;f++){if(c[f][2]>=d)break;if(c[f][1]-c[f][0]>=b)return[c[f][0],c[f][2]]}return[0,d]}function d(a,b,c){var d=a.concat().sort(e),f=[b[0],b[0]+c[0],b[1]+c[1]];for(var i=0,j=d.length;i<j;i++)f[0]<=d[i][0]&&d[i][1]<=f[1]?delete d[i]:d[i]=h(d[i],f);return g(d,f)}function e(a,b){return!a||!b?0:a[2]==b[2]&&a[0]>b[0]||a[2]>b[2]?1:-1}function f(a,b){return!a||!b?0:a[0]>b[0]?1:-1}function g(a,b){var c=a.concat([b]).sort(f),d=[];for(var e=0,g=c.length;e<g;e++){if(!c[e])continue;d.length>0&&d[d.length-1][1]==c[e][0]&&d[d.length-1][2]==c[e][2]?d[d.length-1][1]=c[e][1]:d.push(c[e])}return d}function h(a,b){if(a[0]>=b[0]&&a[0]<b[1]||a[1]>=b[0]&&a[1]<b[1])a[0]>=b[0]&&a[0]<b[1]?a[0]=b[1]:a[1]=b[0];return a}function i(a){var b=a.width(),c=a.height();return b+=Number(a.css("margin-left").replace("px",""))+Number(a.css("padding-left").replace("px",""))+Number(a.get(0).style.borderLeftWidth.replace("px",""))+Number(a.css("margin-right").replace("px",""))+Number(a.css("padding-right").replace("px",""))+Number(a.get(0).style.borderRightWidth.replace("px","")),c+=Number(a.css("margin-top").replace("px",""))+Number(a.css("padding-top").replace("px",""))+Number(a.get(0).style.borderTopWidth.replace("px",""))+Number(a.css("margin-bottom").replace("px",""))+Number(a.css("padding-bottom").replace("px",""))+Number(a.get(0).style.borderBottomWidth.replace("px","")),[b,c]}function j(b){var c=b,d=c.data("_vgchild").length*(c.data("_vgopt").delay||0)+c.data("_vgopt").time||500;c.stop(),c.height()<c.data("_vgwrapheight")?a.browser.msie?c.height(c.data("_vgwrapheight")):c.animate({height:c.data("_vgwrapheight")+"px"},c.data("_vgopt").time||500,"easeOutQuart"):(clearTimeout(c.data("_vgwraptimeout")),c.data("_vgwraptimeout",setTimeout(function(){a.browser.msie?c.height(c.data("_vgwrapheight")):c.animate({height:c.data("_vgwrapheight")+"px"},c.data("_vgopt").time||500,"easeOutQuart")},d)))}function k(b){var c;b.each(function(b){c=a(this),c.css("left",c.data("_vgleft")+"px"),c.css("top",c.data("_vgtop")+"px")})}function l(b,c,d,e){var f=a(b).parent(),g=!1,h=b.length,i,j,k;for(i=0;i<h;i++){j=a(b[i]),k=j.position();if(k.left!=j.data("_vgleft")||k.top!=j.data("_vgtop"))g=!0}g&&(typeof f.data("_vgopt").onStart=="function"&&f.data("_vgopt").onStart(),b.each(function(g){var h=a(this),i={duration:d,easing:c};b.size()-1==g&&(i.complete=f.data("_vgopt").onFinish||null),clearTimeout(h.data("_vgtimeout")),h.data("_vgtimeout",setTimeout(function(){h.animate({left:h.data("_vgleft")+"px",top:h.data("_vgtop")+"px"},i)},g*e))}))}function m(c){c.each(function(c){var d=a(this);clearTimeout(d.data("_vgtimeout")),d.data("_vgtimeout",setTimeout(function(){b(d),l(d.data("_vgchild"),d.data("_vgopt").easing||"linear",d.data("_vgopt").time||500,d.data("_vgopt").delay||0)},50))})}function n(b,c){var d=a("<span />").text(" ").attr("id","_vgridspan").hide().appendTo("body");d.data("size",d.css("font-size")),d.data("timer",setInterval(function(){d.css("font-size")!=d.data("size")&&(d.data("size",d.css("font-size")),c(b))},1e3))}function o(b,c){b.data("vgrid-image-event-added")||(b.data("vgrid-image-event-added",1),b.bind("vgrid-added",function(){b.find("img").each(function(){var d=a(this);d.data("vgrid-image-handler")||(d.data("vgrid-image-handler",1),d.bind("load",function(){c(b)}))})})),b.trigger("vgrid-added");var d=b.append,e=b.prepend;b.append=function(){d.apply(b,arguments),b.trigger("vgrid-added")},b.prepend=function(){e.apply(b,arguments),b.trigger("vgrid-added")}}a.fn.extend({vgrid:function(c){var d=a(this),e=c||{};return e.easeing&&(e.easing=e.easeing),d.each(function(){var c=a(this);c.data("_vgopt",e),c.data("_vgchild",c.find("> *")),c.data("_vgdefchild",c.data("_vgchild")),c.css({position:"relative",width:"auto"}),c.data("_vgchild").css("position","absolute"),b(c),k(c.data("_vgchild"));if(c.data("_vgopt").fadeIn){var d=typeof c.data("_vgopt").fadeIn=="object"?c.data("_vgopt").fadeIn:{time:c.data("_vgopt").fadeIn};c.data("_vgchild").each(function(b){var c=a(this);if(c.css("display")=="none")return!0;c.stop().fadeTo(0,0),setTimeout(function(){c.stop().fadeTo(d.time||250,1)},b*(d.delay||0))})}a(window).resize(function(a){m(c)}),e.useLoadImageEvent&&o(c,m),e.useFontSizeListener&&n(c,m)}),d},vgrefresh:function(c,d,e,f){var g=a(this);return g.each(function(){var g=a(this),h=g.data("_vgopt")||{};g.data("_vgchild")&&(g.data("_vgchild",g.find("> *")),g.data("_vgchild").css("position","absolute"),b(g),d=typeof d=="number"?d:g.data("_vgopt").time||500,e=typeof e=="number"?e:g.data("_vgopt").delay||0,l(g.data("_vgchild"),c||g.data("_vgopt").easing||"linear",d,e),typeof f=="function"&&setTimeout(f,g.data("_vgchild").length*e+d)),h.useLoadImageEvent&&o(g,m)}),g},vgsort:function(c,d,e,f){var g=a(this);return g.each(function(){var g=a(this);g.data("_vgchild")&&(g.data("_vgchild",g.data("_vgchild").sort(c)),g.data("_vgchild").each(function(b){a(this).appendTo(g)}),b(g),l(g.data("_vgchild"),d||g.data("_vgopt").easing||"linear",typeof e=="number"?e:g.data("_vgopt").time||500,typeof f=="number"?f:g.data("_vgopt").delay||0))}),g}})})(jQuery);